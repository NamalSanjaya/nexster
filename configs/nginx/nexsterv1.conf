server {
   listen 80;

  server_name 192.168.1.101;

  # test uri which is not used in nexster apis
  location /test {
        proxy_pass http://localhost:8000/usrmgmt/test;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # fetch recent posts for public timeline
  location ~ ^/recent_posts/(?<userid>[^/]+) {
	proxy_pass http://localhost:8001/timeline/recent_posts/$userid?$args;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # to my posts for private timeline. (viewer==owner)
  location ~ ^/my_posts/(?<userid>[^/]+) {
        proxy_pass http://localhost:8001/timeline/my_posts/$userid?$args;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   }

  # list friend suggestions for userid
  location /friend_sugs {
        proxy_pass http://localhost:8001/timeline/friend_sugs;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # create reactions (POST)
  location /reactions {
      # Add configuration for POST requests
      proxy_pass http://localhost:8001/timeline/reactions;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
 
  # update reactions (PUT)
  location ~ ^/reactions/(?<reaction_id>[^/]+) {
      # Add configuration for PUT requests
      proxy_pass http://localhost:8001/timeline/reactions/$reaction_id?$args;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # test api - set cookie (remove once done the development)
   location /set-cookie {
      proxy_pass http://localhost:8000/usrmgmt/set-cookie;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

   # Get User Info (GET)
  location ~ ^/u/users/(?<user_id>[^/]+) {
      proxy_pass http://localhost:8000/usrmgmt/users/$user_id;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
 
  # Get Friends Count (GET)
  location ~ ^/u/friends/(?<user_id>[^/]+)/count {
      proxy_pass http://localhost:8000/usrmgmt/friends/$user_id/count;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Get user id for given index No (GET)
  location ~ ^/u/indexnos/(?<index_no>[^/]+) {
      proxy_pass http://localhost:8000/usrmgmt/indexnos/$index_no;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # list media and role is dynamically seleted (GET)
  location ~ ^/t/r/media/(?<img_owner_id>[^/]+) {
      proxy_pass http://localhost:8001/timeline/r/media/$img_owner_id?$args;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
 
  # List friend request (GET)
  location /u/friend_req {
    proxy_pass http://localhost:8000/usrmgmt/friend_req?$args;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  } 

  # Get friend requests count
  location /u/friend_req/count {
    proxy_pass http://localhost:8000/usrmgmt/friend_req/count;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

   # Ignore Friend Request (DELETE)
  location ~ ^/u/friend_req/(?<friend_req_id>[^/]+)/ignore {
      proxy_pass http://localhost:8000/usrmgmt/friend_req/$friend_req_id?$args;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
  
   # Accept Friend Request (POST)
  location ~ ^/u/friend_req/(?<friend_req_id>[^/]+) {
      proxy_pass http://localhost:8000/usrmgmt/friend_req/$friend_req_id;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

   # List Friends For Pool (GET)
  location ~ ^/t/friend_sugs/v2/(?<faculty>[^/]+) {
      proxy_pass http://localhost:8001/timeline/friend_sugs/v2/$faculty?$args;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

   # Send Friend Request (POST)
  location /p/u/friend_req {
    proxy_pass http://localhost:8000/usrmgmt/friend_req;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

   # Remove friendship (DELETE)
  location ~ ^/d/u/friend/(?<otherFriendId>[^/]+) {
      proxy_pass http://localhost:8000/usrmgmt/friend/$otherFriendId;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

   # List my Friends (GET)
  location ~ ^/g/u/all/friends {
      proxy_pass http://localhost:8000/usrmgmt/all/friends?$args;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
